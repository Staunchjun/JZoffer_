# **HTTP权威指南笔记**

## WEB
web内容存储在web服务器上，而web服务器使用的是http协议
### uri统一资源标识符号
1. URL：url统一资源定位符（描述一个资源在服务器上的特定位置）
2. URN：urn统一资源名（特定资源的唯一名称使用，和资源所在地无关）
### 事务
事务由请求命令+响应结果组成。
请求命令（http方法）分为GET,PUT,DELETE,POST,HEAD.
### web结构组件
1. 代理（客户端和服务器之间的HTTP中间实体）
2. 缓存（HTTP仓库，使常用页面的副本保存在离客户端近的地方）
3. 网关（连接其他应用程序的特殊Web服务器）
4. 隧道（对Http通信报文进行盲转发的特殊代理）
5. Agent代理（发起自动Http请求的半智能Web客户端）
### URL结构
url的三部分：`http://www.company.baidu.com/ss/index.html`
默认方案
**<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>**
默认为80端口
1. http->方案（怎么做）
2. `www.company.baidu.com`->主机（位于何处，使用DNS解析成ip地址的形式）
3. /ss/index.html->路径（哪个资源）
# HTTP报文是HTTP应用程序间发送的数据块。
1. 起始行{请求行（请求方法+请求URL）响应行（HTTP版本+状态码+描述操作状态的文本形式的原因语）
eg：HTTP/1.0 200 OK}
2. 首部：通用~（Date：Tue,3Oct....），请求~(Accept:*/*)，响应~(Server:Tiki-Hut/1.0)，实体~(Content-Type:text/html;charset=iso-latin-1)，扩展~(由应用程序开发者开发创建)。
3. 实体的主题部分

## 状态码
1. 100-199信息性状态码
2. 200-299成功状态码
3. 300-399重定向状态码
4. 400-499客户端错误状态码
5. 500-599服务器错误状态码

## 连接管理->TCP连接
TCP流是分段的，由IP分组传送（每个TCP段都是由IP分组承载）。
HTTPS和HTTP的区别在于在应用层的（HTTP）和传输层的（TCP）中间插入了一层安全层（TSL和SSL）

## TCP慢启动
用于防止因特网的突然过载和拥塞

## Nagle算法和TCP_NODELAY
### 原理
Nagle算法试图在发送一个分组之前将大量的TCP数据绑定在一起用以提高网络效率。
（先缓存数据直至积累到一个足够发送的全尺寸数据的时候才将数据发送出去）

### 引发的问题
1. 可能因为等待一个永远不会到来的额外数据而产生延迟。
2. 确认分组自身会被延迟确认算法延迟100~200毫秒。
HTTP应用程序常常会在自己的栈中设置参数TCP_NODELAY,禁用Nagle算法，提高性能。
如果这么做的话呢，一定要确保会向TCP写入大块的数据，这样就不会产生一堆的小分组。
## TIME_WAIT累积和端口耗尽
当某个 TCP 端点关闭 TCP 连接时，会在内存中维护一个小的控制块，用来记录最
近所关闭连接的 IP 地址和端口号。这类信息只会维持一小段时间，通常是所估计的
最大分段使用期的两倍（称为 2MSL，通常为 2 分钟 8）左右，以确保在这段时间内
不会创建具有相同地址和端口号的新连接。实际上，这个算法可以防止在两分钟内
创建、关闭并重新创建两个具有相同 IP 地址和端口号的连接。
## HTTP连接处理
### Connection首部
承载3种不同类型的标签
1. HTTP首部字段名
2. 任意标签值
3. 值close说明操作完成后需要关闭这条持久
###提高HTTP的连接性能
1. 并行连接
    缺点并行加载多个对象，每个对象竞争有限的带宽
2. 持久连接
    持久连接会在不同事务之间保持打开状态，直到客户端或者服务器决定将其关闭为止
    相比并行连接，降低了时延和连接建立的开销，将连接保持在已调谐的状态，减少打开
    连接的勤在数量，缺点是容易累积出现大量空闲连接，耗费本地以及远程客户端和服务
    器上的资源
    1. HTTP/1.0+ keep-alive
    2. HTTP/1.1 persistent
3. 管道化连接
    **限制**
   1. 如果 HTTP 客户端无法确认连接是持久的，就不应该使用管道。
   2. 必须按照与请求相同的顺序回送 HTTP 响应。HTTP 报文中没有序列号标签，因
   此如果收到的响应失序了，就没办法将其与请求匹配起来了。
   3. HTTP 客户端必须做好连接会在任意时刻关闭的准备，还要准备好重发所有未完
   成的管道化请求。如果客户端打开了一条持久连接，并立即发出了 10 条请求，
   服务器可能在只处理了，比方说，5 条请求之后关闭连接。剩下的 5 条请求会失败，
   客户端必须能够应对这些过早关闭连接的情况，重新发出这些请求。
   4. HTTP 客户端不应该用管道化的方式发送会产生副作用的请求（比如 POST）。总
   之，出错的时候，管道化方式会阻碍客户端了解服务器执行的是一系列管道化请
   求中的哪一些。由于无法安全地重试 POST 这样的非幂等请求，所以出错时，就
   存在某些方法永远不会被执行的风险。
4. 复用连接
### ＷＥＢ服务器
1. 建立连接
2. 接受请求
3. 处理请求
4. 访问资源
5. 构建响应
6. 发送响应
7. 记录事务处理过程
### 代理
1. 私有和共享代理
代理服务器可以是某个客户端专用的，也可以是很多客户端共享的。单个客户端专
用的代理被称为私有代理。众多客户端共享的代理被称为公共代理。
2. 代理与网关对比
**代理连接**的是两个或多个使用**相同协议**的**应用程序**，而**网关连接**的则是
两个或多个使用**不同协议**的**端点**。**网关**扮演的是**“协议转换器”**的角色，即使客户
端和服务器使用的是不同的协议，客户端也可以通过它完成与服务器之间的事务
处理。
3. 为什么使用代理
    1. 儿童过滤
    2. 文档访问控制
    3. 安全防火墙
    4. Web缓存
    5. 反向代理－>提高访问慢速Web服务器上公共内容时的性能
    6. 内容路由器
    7. 转码器
4. 代理的部署
    1. 出口代理
    2. 访问代理（入口）
    3. 反向代理
    4. 网络交换代理
5. 代理的层次结构
6. 代理既可以处理代理请求，也可以处理服务器请求
## 缓存

